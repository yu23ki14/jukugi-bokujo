# ステップ2: 知識の自動拡張（Web検索統合）

## 概要

ユーザーが手動で知識を追加しなくても、必要に応じて自動的にWeb検索を実行し、情報を取得できるようにする。

## 背景

現在のシステムでは、エージェントが持つ知識はユーザーが手動で登録したもののみに限定されている。これにより以下の課題がある：

- ユーザーの知識入力負担が大きい
- リアルタイムの情報にアクセスできない
- 議論中に必要な情報が不足しても補完できない
- 実在の人物・組織を代表するには情報量が不足

## 実装内容

### 1. Web検索APIの統合

- Brave Search API または Tavily APIの導入
- API認証情報の環境変数設定
- 検索クエリの実行とレスポンスのパース

### 2. 検索トリガーロジック

- LLMによる情報不足の検出
- 議論のコンテキストから適切な検索クエリを生成
- 検索の実行タイミングの制御（過剰な検索を防ぐ）

### 3. 検索結果の処理

- 検索結果の要約・構造化
- 一時的な知識として議論に注入
- ユーザー承認後の永続化オプション

### 4. 既存コードの統合

- `apps/backend/src/queue/turn-consumer.ts`への検索ロジック追加
- 検索結果のプロンプト注入
- 検索履歴の保存（オプション）

## 技術スタック

- **Brave Search API**: プライバシー重視、無料枠あり
- または **Tavily API**: AI向けに最適化された検索API
- **LLM**: 検索クエリ生成と結果の要約に使用
- **D1データベース**: 検索履歴・永続化された知識の保存

## リリース価値

- エージェントが「リアルタイムの情報」にアクセス可能に
- ユーザーの知識入力負担を大幅に軽減
- より現実的な人物・組織を代表できるようになる
- 議論の質と深さが向上

## 実装規模

中

## 検討事項

- 検索APIのコスト管理
- 検索結果の信頼性評価
- 検索頻度の制限（レート制限、コスト制限）
- ユーザーへの検索実行の通知方法

## 参考

- [Brave Search API](https://brave.com/search/api/)
- [Tavily API](https://tavily.com/)
- 元のリサーチ: #46

---

**関連Issue**: #46
